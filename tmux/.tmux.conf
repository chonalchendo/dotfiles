# =============================================================================
# TMUX CONFIGURATION - AI-FOCUSED DEVELOPMENT WORKFLOW
# =============================================================================

# =============================================================================
# CORE SETTINGS
# =============================================================================
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Remove delay for exiting insert mode with ESC in Neovim
set -sg escape-time 10

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Enable focus events (for Neovim autoread)
set -g focus-events on

# =============================================================================
# PREFIX KEY
# =============================================================================
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# =============================================================================
# WINDOW & PANE MANAGEMENT
# =============================================================================
# Split panes using / and - (more intuitive)
unbind %
unbind '"'
bind / split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Resize panes with vim keys
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# Toggle zoom on current pane
bind -r m resize-pane -Z

# Quick window switching
bind -r Tab last-window

# =============================================================================
# AI AGENT KEYBINDINGS
# =============================================================================
# Prefix + a enters "AI mode" with agent-specific bindings
bind a switch-client -T ai_table

# New windows with agents
bind -T ai_table o new-window -n "opencode" "opencode"
bind -T ai_table c new-window -n "claude" "claude"
bind -T ai_table n new-window -n "nvim" "nvim"

# Split current window with agents (agent on right)
bind -T ai_table O split-window -h -c "#{pane_current_path}" "opencode"
bind -T ai_table C split-window -h -c "#{pane_current_path}" "claude"

# AI development layout: 60% left (nvim), 40% right (agent)
bind -T ai_table w select-layout main-vertical \; resize-pane -t 0 -x 60%

# List all windows (quick overview of running agents)
bind -T ai_table l list-windows

# Quick agent in popup (temporary, closes when done)
bind -T ai_table p display-popup -E -w 80% -h 80% "opencode"
bind -T ai_table P display-popup -E -w 80% -h 80% "claude"

# =============================================================================
# SESSION MANAGEMENT
# =============================================================================
# Session switcher with fzf popup
bind s display-popup -E -w 60% -h 60% "\
    tmux list-sessions -F '#{session_name}' | \
    fzf --reverse --header='Switch Session' | \
    xargs -I {} tmux switch-client -t {}"

# New session prompt
bind S command-prompt -p "New session name:" "new-session -s '%%'"

# Kill session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# =============================================================================
# COPY MODE (VI STYLE)
# =============================================================================
setw -g mode-keys vi

# Enter copy mode
bind v copy-mode

# Vi-style selection
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel

# =============================================================================
# PLUGINS
# =============================================================================
set -g @plugin 'tmux-plugins/tpm'

# Catppuccin theme (consistent with Neovim and WezTerm)
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_window_status_style "rounded"

# Status bar modules
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_status_modules_right "session date_time"
set -g @catppuccin_date_time_text "%H:%M"

# Seamless navigation between tmux panes and Neovim splits
set -g @plugin 'christoomey/vim-tmux-navigator'

# Session persistence
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Resurrect settings
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Auto-save and restore sessions
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'

# =============================================================================
# INITIALIZE TPM (keep at bottom)
# =============================================================================
run '~/.tmux/plugins/tpm/tpm'
