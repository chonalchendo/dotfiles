# =============================================================================
# TMUX CONFIGURATION - AI-FOCUSED DEVELOPMENT WORKFLOW
# =============================================================================

# =============================================================================
# CORE SETTINGS
# =============================================================================
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Remove delay for exiting insert mode with ESC in Neovim
set -sg escape-time 10

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Enable focus events (for Neovim autoread)
set -g focus-events on

# =============================================================================
# PREFIX KEY
# =============================================================================
unbind C-b

# Use backtick (`) as prefix - single key, no modifiers needed
set -g prefix `
bind ` send-prefix

# To type a literal backtick, press ` twice

# =============================================================================
# WINDOW & PANE MANAGEMENT
# =============================================================================
# Split panes using / and - (more intuitive)
unbind %
unbind '"'
bind / split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Resize panes with vim keys
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# Toggle zoom on current pane
bind -r m resize-pane -Z

# =============================================================================
# WINDOW/TAB NAVIGATION 
# =============================================================================
# ` + Tab = last window (quick toggle)
bind Tab last-window

# ` + h/l = previous/next window
bind h previous-window
bind l next-window

# ` + number = switch to window
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9

# ` + w = window picker (visual selector)
bind w choose-window

# =============================================================================
# AI AGENT KEYBINDINGS (` + key)
# =============================================================================
# Direct bindings - just ` then the key
bind o new-window -n "opencode" "/opt/homebrew/bin/opencode"
bind O split-window -h -c "#{pane_current_path}" "/opt/homebrew/bin/opencode"
bind i new-window -n "claude" "/Users/conal/.nvm/versions/node/v22.17.0/bin/claude"
bind I split-window -h -c "#{pane_current_path}" "/Users/conal/.nvm/versions/node/v22.17.0/bin/claude"
bind n new-window -n "nvim" "/opt/homebrew/bin/nvim"
bind p display-popup -E -w 80% -h 80% "/opt/homebrew/bin/opencode"
bind P display-popup -E -w 80% -h 80% "/Users/conal/.nvm/versions/node/v22.17.0/bin/claude"

# =============================================================================
# SESSION MANAGEMENT
# =============================================================================
# Session switcher with fzf popup
bind s display-popup -E -w 60% -h 60% "\
    tmux list-sessions -F '#{session_name}' | \
    fzf --reverse --header='Switch Session' | \
    xargs -I {} tmux switch-client -t {}"

# New session prompt
bind S command-prompt -p "New session name:" "new-session -s '%%'"

# Kill session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# =============================================================================
# COPY MODE (VI STYLE)
# =============================================================================
setw -g mode-keys vi

# Enter copy mode
bind v copy-mode

# Vi-style selection
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel

# =============================================================================
# PLUGINS
# =============================================================================
set -g @plugin 'tmux-plugins/tpm'

# Catppuccin theme (consistent with Neovim and WezTerm)
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha'

# =============================================================================
# STATUS BAR STYLING (Catppuccin Pastel)
# =============================================================================
# Window styling
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_number_position "left"

# Window format with icons
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text " #W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text " #W"

# Pane styling
set -g @catppuccin_pane_border_style "fg=#45475a"
set -g @catppuccin_pane_active_border_style "fg=#cba6f7"

# Status bar position and styling
set -g status-position bottom
set -g status-justify left

# Left side: session info with icon
set -g @catppuccin_status_left_separator "█"
set -g @catppuccin_status_right_separator "█"
set -g @catppuccin_status_connect_separator "no"

# Status modules (right side)
set -g @catppuccin_status_modules_right "directory session date_time"

# Directory module
set -g @catppuccin_directory_text " #{b:pane_current_path}"
set -g @catppuccin_directory_icon ""

# Session module  
set -g @catppuccin_session_icon ""
set -g @catppuccin_session_text " #S"

# Date/time module with icon
set -g @catppuccin_date_time_icon "󰥔"
set -g @catppuccin_date_time_text " %H:%M"

# Seamless navigation between tmux panes and Neovim splits
set -g @plugin 'christoomey/vim-tmux-navigator'

# Session persistence
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Resurrect settings
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Auto-save and restore sessions
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'

# =============================================================================
# INITIALIZE TPM (keep at bottom)
# =============================================================================
run '~/.tmux/plugins/tpm/tpm'
