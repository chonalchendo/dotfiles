# =============================================================================
# TMUX CONFIGURATION - AI-FOCUSED DEVELOPMENT WORKFLOW
# =============================================================================

# =============================================================================
# CORE SETTINGS
# =============================================================================
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Remove delay for exiting insert mode with ESC in Neovim
set -sg escape-time 10

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Enable focus events (for Neovim autoread)
set -g focus-events on

# =============================================================================
# PREFIX KEY
# =============================================================================
unbind C-b

# Use backtick (`) as prefix - single key, no modifiers needed
set -g prefix `
bind ` send-prefix

# To type a literal backtick, press ` twice

# =============================================================================
# WINDOW & PANE MANAGEMENT
# =============================================================================
# Split panes using / and - (more intuitive)
unbind %
unbind '"'
bind / split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Resize panes with vim keys
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# Toggle zoom on current pane
bind -r m resize-pane -Z

# =============================================================================
# WINDOW/TAB NAVIGATION 
# =============================================================================
# ` + Tab = last window (quick toggle)
bind Tab last-window

# ` + h/l = previous/next window
bind h previous-window
bind l next-window

# ` + number = switch to window
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9

# ` + w = window picker (visual selector)
bind w choose-window

# =============================================================================
# AI AGENT KEYBINDINGS (` + key)
# =============================================================================
# Direct bindings - just ` then the key
bind o new-window -n "opencode" "/opt/homebrew/bin/opencode"
bind O split-window -h -c "#{pane_current_path}" "/opt/homebrew/bin/opencode"
bind i new-window -n "claude" "/Users/conal/.nvm/versions/node/v22.17.0/bin/claude"
bind I split-window -h -c "#{pane_current_path}" "/Users/conal/.nvm/versions/node/v22.17.0/bin/claude"
bind n new-window -n "nvim" "/opt/homebrew/bin/nvim"
bind p display-popup -E -w 80% -h 80% "/opt/homebrew/bin/opencode"
bind P display-popup -E -w 80% -h 80% "/Users/conal/.nvm/versions/node/v22.17.0/bin/claude"

# =============================================================================
# SESSION MANAGEMENT
# =============================================================================
# Session switcher with fzf popup
bind s display-popup -E -w 60% -h 60% "\
    tmux list-sessions -F '#{session_name}' | \
    fzf --reverse --header='Switch Session' | \
    xargs -I {} tmux switch-client -t {}"

# New session prompt
bind S command-prompt -p "New session name:" "new-session -s '%%'"

# Kill session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# =============================================================================
# COPY MODE (VI STYLE)
# =============================================================================
setw -g mode-keys vi

# Enter copy mode
bind v copy-mode

# Vi-style selection
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel

# =============================================================================
# CATPPUCCIN THEME CONFIGURATION
# =============================================================================
# Set flavor BEFORE loading the plugin
set -g @catppuccin_flavor 'mocha'

# Window styling
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_default_text " #W"
set -g @catppuccin_window_current_text " #W"

# Pane borders
set -g @catppuccin_pane_border_style "fg=#45475a"
set -g @catppuccin_pane_active_border_style "fg=#cba6f7"

# Module customization (icons and colors)
set -g @catppuccin_directory_icon ""
set -g @catppuccin_directory_color "#{@thm_pink}"
set -g @catppuccin_session_icon ""
set -g @catppuccin_session_color "#{@thm_mauve}"
set -g @catppuccin_date_time_icon "ó°¥”"
set -g @catppuccin_date_time_color "#{@thm_lavender}"
set -g @catppuccin_date_time_text " %H:%M"

# Load catppuccin BEFORE setting status line
run ~/.tmux/plugins/catppuccin/catppuccin.tmux

# =============================================================================
# STATUS BAR (After catppuccin loads)
# =============================================================================
set -g status-position bottom
set -g status-justify left
set -g status-right-length 100
set -g status-left-length 100

# Left side: empty (windows show automatically)
set -g status-left ""

# Right side: directory + session + time using catppuccin modules
set -g status-right "#{E:@catppuccin_status_directory}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_date_time}"

# =============================================================================
# OTHER PLUGINS (Load after catppuccin)
# =============================================================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'

# Seamless navigation between tmux panes and Neovim splits
set -g @plugin 'christoomey/vim-tmux-navigator'

# Session persistence
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Resurrect settings
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Auto-save and restore sessions
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'

# =============================================================================
# TMUX-SESSIONX - Fuzzy Session Manager (omerxx)
# =============================================================================
set -g @plugin 'omerxx/tmux-sessionx'
set -g @sessionx-bind 'e'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-auto-accept 'off'
set -g @sessionx-filter-current 'false'
set -g @sessionx-preview-enabled 'true'

# =============================================================================
# TMUX-FLOAX - Floating Terminal Windows (omerxx)
# =============================================================================
set -g @plugin 'omerxx/tmux-floax'
set -g @floax-bind 'f'
set -g @floax-width '80%'
set -g @floax-height '80%'
set -g @floax-border-color 'magenta'
set -g @floax-text-color 'blue'
set -g @floax-change-path 'true'

# =============================================================================
# TMUX-FZF-URL - Extract & Open URLs from Panes
# =============================================================================
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# =============================================================================
# TMUX-THUMBS - Quick Copy with Hints (like Vimium)
# =============================================================================
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @thumbs-key 't'
set -g @thumbs-command 'echo -n {} | pbcopy'
set -g @thumbs-upcase-command 'echo -n {} | pbcopy'

# =============================================================================
# TMUX-FZF - General FZF Integration
# =============================================================================
set -g @plugin 'sainnhe/tmux-fzf'
TMUX_FZF_LAUNCH_KEY="C-f"

# =============================================================================
# INITIALIZE TPM (keep at bottom)
# =============================================================================
run '~/.tmux/plugins/tpm/tpm'
